import pytest
import os

from config import read_subscribe_config_from_env

from subscribe import ensure_subscribed

NON_EXISTENT_SUBSCRIPTION_ASID = '00000000000000000000000000000000'

def in_gocd():
    return os.getenv('GO_PIPELINE_NAME') is not None

@pytest.mark.skipif(condition=in_gocd(), reason='currently connection to opentest and NEMS only working from local laptop')
def test_that_a_subscription_is_created_if_none_already_exists():
    config = read_subscribe_config_from_env()

    config.asid = NON_EXISTENT_SUBSCRIPTION_ASID

    result = ensure_subscribed(config=config)

    assert result == 201
